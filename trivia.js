let tests = {
	"Test 1" : [{"category":"Entertainment: Television","type":"multiple","difficulty":"medium","question":"In what year did &quot;The Big Bang Theory&quot; debut on CBS?","correct_answer":"2007","incorrect_answers":["2008","2006","2009"]},{"category":"Geography","type":"multiple","difficulty":"medium","question":"Which city is the capital of Switzerland?","correct_answer":"Bern","incorrect_answers":["Z&uuml;rich","Frankfurt","Wien"]},{"category":"Animals","type":"multiple","difficulty":"hard","question":"How many known living species of hyenas are there?","correct_answer":"4","incorrect_answers":["8","2","6"]},{"category":"History","type":"multiple","difficulty":"hard","question":"The Battle of Hastings was fought in which year?","correct_answer":"1066","incorrect_answers":["911","1204","1420"]},{"category":"Entertainment: Music","type":"multiple","difficulty":"hard","question":"&quot;All the Boys&quot; by Panic! At the Disco was released as a bonus track on what album?","correct_answer":"Too Weird To Live, Too Rare To Die!","incorrect_answers":["A Fever You Can&#039;t Sweat Out","Death Of A Bachelor","Vices &amp; Virtues"]},{"category":"Entertainment: Music","type":"multiple","difficulty":"easy","question":"What was Daft Punk&#039;s first studio album?","correct_answer":"Homework","incorrect_answers":["Discovery","Random Access Memories","Human After All"]},{"category":"Science & Nature","type":"multiple","difficulty":"hard","question":"How much radiation does a banana emit?","correct_answer":"0.1 Microsievert","incorrect_answers":["0.3 Microsievert","0.5 Microsievert","0.7 Microsievert"]},{"category":"Sports","type":"multiple","difficulty":"hard","question":"What is the full name of the footballer &quot;Cristiano Ronaldo&quot;?","correct_answer":"Cristiano Ronaldo dos Santos Aveiro","incorrect_answers":["Cristiano Ronaldo los Santos Diego","Cristiano Armando Diego Ronaldo","Cristiano Luis Armando Ronaldo"]},{"category":"Animals","type":"multiple","difficulty":"medium","question":"The dish Fugu, is made from what family of fish?","correct_answer":"Pufferfish","incorrect_answers":["Bass","Salmon","Mackerel"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"medium","question":"What are the names of the Ice Climbers in the video game Ice Climber?","correct_answer":"Popo and Nana","incorrect_answers":["Popo and Nina","Papi and Nana","Papi and Nina"]}],
	
	"Test 2" : [{"category":"Vehicles","type":"multiple","difficulty":"hard","question":"What was the name of the first front-wheel-drive car produced by Datsun (now Nissan)?","correct_answer":"Cherry","incorrect_answers":["Sunny","Bluebird","Skyline"]},{"category":"History","type":"multiple","difficulty":"medium","question":"America&#039;s Strategic Defense System during the Cold War was nicknamed after this famous movie.","correct_answer":"Star Wars","incorrect_answers":["Jaws","Blade Runner","Alien"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"medium","question":"In Portal 2, the iconic character GLaDOS is turned into:","correct_answer":"A potato","incorrect_answers":["A tomato","A lemon","An apple"]},{"category":"History","type":"multiple","difficulty":"hard","question":"When did Canada leave the confederation to become their own nation?","correct_answer":"July 1st, 1867","incorrect_answers":["July 1st, 1763","July 1st, 1832","July 1st, 1902"]},{"category":"Entertainment: Music","type":"multiple","difficulty":"easy","question":"The &quot;K&quot; in &quot;K-Pop&quot; stands for which word?","correct_answer":"Korean","incorrect_answers":["Kenyan","Kazakhstan","Kuwaiti"]},{"category":"History","type":"boolean","difficulty":"medium","question":"United States President Ronald Reagan was the first president to appoint a woman to the Supreme Court. ","correct_answer":"True","incorrect_answers":["False"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"easy","question":"What is the name of the 4-armed Chaos Witch from the 2016 video game &quot;Battleborn&quot;?","correct_answer":"Orendi","incorrect_answers":["Orendoo","Oranda","Randy"]},{"category":"Entertainment: Music","type":"multiple","difficulty":"medium","question":"Ellie Goulding&#039;s earliest album was named?","correct_answer":"Lights","incorrect_answers":["Halcyon","Bright Lights","Halcyon Days"]},{"category":"Entertainment: Music","type":"multiple","difficulty":"easy","question":"Which former boy-band star released hit solo single &quot;Angels&quot; in 1997?","correct_answer":"Robbie Williams","incorrect_answers":["Justin Timberlake","Harry Styles","Gary Barlow"]},{"category":"Entertainment: Japanese Anime & Manga","type":"multiple","difficulty":"medium","question":"In &quot;Puella Magi Madoka Magica&quot;, what is the first name of Madoka&#039;s younger brother?","correct_answer":"Tatsuya","incorrect_answers":["Montoya","Tomohisa","Minato"]}],
	
	"Test 3" : [{"category":"Entertainment: Video Games","type":"multiple","difficulty":"easy","question":"Which game did &quot;Sonic The Hedgehog&quot; make his first appearance in?","correct_answer":"Rad Mobile","incorrect_answers":["Sonic The Hedgehog","Super Mario 64","Mega Man"]},{"category":"Politics","type":"multiple","difficulty":"medium","question":"Who was the only president to not be in office in Washington D.C?","correct_answer":"George Washington","incorrect_answers":["Abraham Lincoln","Richard Nixon","Thomas Jefferson"]},{"category":"Entertainment: Books","type":"multiple","difficulty":"hard","question":"In the Harry Potter universe, who does Draco Malfoy end up marrying?","correct_answer":"Astoria Greengrass","incorrect_answers":["Pansy Parkinson","Millicent Bulstrode","Hermione Granger"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"medium","question":"In what year was the original Sonic the Hedgehog game released?","correct_answer":"1991","incorrect_answers":["1989","1993","1995"]},{"category":"General Knowledge","type":"multiple","difficulty":"medium","question":"What is the name given to Indian food cooked over charcoal in a clay oven?","correct_answer":"Tandoori","incorrect_answers":["Biryani","Pani puri","Tiki masala"]},{"category":"Vehicles","type":"multiple","difficulty":"easy","question":"Automobiles produced by Telsa Motors operate on which form of energy?","correct_answer":"Electricity","incorrect_answers":["Gasoline","Diesel","Nuclear"]},{"category":"Entertainment: Music","type":"multiple","difficulty":"easy","question":"Who was featured in the song &quot;Words&quot; by Feint? ","correct_answer":"Laura Brehm","incorrect_answers":["Anna Yvette ","Danyka Nadeau","Veela"]},{"category":"Entertainment: Film","type":"multiple","difficulty":"medium","question":"Leonardo Di Caprio won his first Best Actor Oscar for his performance in which film?","correct_answer":"The Revenant","incorrect_answers":["The Wolf Of Wall Street","Shutter Island","Inception"]},{"category":"Sports","type":"multiple","difficulty":"medium","question":"What year was hockey legend Wayne Gretzky born?","correct_answer":"1961","incorrect_answers":["1965","1959","1963"]},{"category":"Entertainment: Film","type":"multiple","difficulty":"hard","question":"Which sci-fi cult films plot concerns aliens attempting to prevent humans from creating a doomsday weapon?","correct_answer":"Plan 9 from Outer Space","incorrect_answers":["The Man from Planet X","It Came from Outer Space","The Day The Earth Stood Still"]}],
	
	"Test 4" : [{"category":"Entertainment: Cartoon & Animations","type":"boolean","difficulty":"easy","question":"In the &quot;Shrek&quot; film franchise, Donkey is played by Eddie Murphy.","correct_answer":"True","incorrect_answers":["False"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"medium","question":"What was the character Kirby originally going to be named?","correct_answer":"Popopo","incorrect_answers":["Dedede","Waddle Dee","Prince Puff"]},{"category":"Geography","type":"multiple","difficulty":"medium","question":"Which country inside the United Kingdom does NOT appear on its flag, the Union Jack?","correct_answer":"Wales","incorrect_answers":["Scotland","Ireland","Isle of Wight"]},{"category":"Mythology","type":"multiple","difficulty":"easy","question":"Who in Greek mythology, who led the Argonauts in search of the Golden Fleece?","correct_answer":"Jason","incorrect_answers":["Castor","Daedalus","Odysseus"]},{"category":"Animals","type":"multiple","difficulty":"medium","question":"Cashmere is the wool from which kind of animal?","correct_answer":"Goat","incorrect_answers":["Sheep","Camel","Llama"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"hard","question":"In Halo 2, how many rounds does the M6C hold in a single magazine?","correct_answer":"12","incorrect_answers":["6","36","18"]},{"category":"Entertainment: Film","type":"multiple","difficulty":"medium","question":"Who played the Cenobite called &quot;Pinhead&quot; in the original Hellraiser films?","correct_answer":"Doug Bradley","incorrect_answers":["Doug Jones","Doug Savant","Doug Benson"]},{"category":"Entertainment: Comics","type":"multiple","difficulty":"medium","question":"In the comics, which Sonic character took command of the Dark Legion after Luger&#039;s assassination?","correct_answer":"Lien-Da","incorrect_answers":["Kragok","Dimitri","Remington"]},{"category":"Entertainment: Japanese Anime & Manga","type":"multiple","difficulty":"medium","question":"In Haikyuu!!, who is not a member of Karasuno VBC?","correct_answer":"Shigeru Yahaba","incorrect_answers":["Tadashi Yamaguchi","Hisashi Kinoshita","Kazuhito Narita"]},{"category":"Entertainment: Musicals & Theatres","type":"multiple","difficulty":"medium","question":"The musical &quot;Dirty Rotten Scoundrels&quot; is set in what country?","correct_answer":"France","incorrect_answers":["USA","Germany","Sweden"]}],
	
	"Test 5" : [{"category":"Entertainment: Television","type":"multiple","difficulty":"easy","question":"What was the name of the police officer in the cartoon &quot;Top Cat&quot;?","correct_answer":"Dibble","incorrect_answers":["Barbrady","Mahoney","Murphy"]},{"category":"Animals","type":"multiple","difficulty":"easy","question":"The K\u0101k\u0101p\u014d is a large, flightless, nocturnal parrot native to which country?","correct_answer":"New Zealand","incorrect_answers":["South Africa","Australia","Madagascar"]},{"category":"Entertainment: Musicals & Theatres","type":"multiple","difficulty":"medium","question":"In which Shakespeare play does the character Marcellus say, &quot;Something is rotten in the state of Denmark&quot;?","correct_answer":"Hamlet","incorrect_answers":["Macbeth","King Lear","Twelfth Night"]},{"category":"Entertainment: Music","type":"multiple","difficulty":"hard","question":"Which M83 album is the song &quot;Midnight City&quot; featured in?","correct_answer":"Hurry Up, We&#039;re Dreaming","incorrect_answers":["Saturdays = Youth","Before the Dawn Heals Us","Junk"]},{"category":"Entertainment: Music","type":"multiple","difficulty":"easy","question":"Which of these songs by Skrillex features Fatman Scoop as a side artist?","correct_answer":"Recess","incorrect_answers":["All is Fair in Love and Brostep","Rock N Roll (Will Take You to the Mountain)","Scary Monsters and Nice Sprites"]},{"category":"Science: Computers","type":"multiple","difficulty":"medium","question":"Generally, which component of a computer draws the most power?","correct_answer":"Video Card","incorrect_answers":["Hard Drive","Processor","Power Supply"]},{"category":"Vehicles","type":"multiple","difficulty":"medium","question":"Which supercar company is from Sweden?","correct_answer":"Koenigsegg","incorrect_answers":["Bugatti","Lamborghini","McLaren"]},{"category":"Geography","type":"multiple","difficulty":"hard","question":"What is the area of Vatican City?","correct_answer":"0.44km^2","incorrect_answers":["0.10km^2","0.86km^2","12.00km^2"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"medium","question":"Final Fantasy VI was originally released outside Japan under what name?","correct_answer":"Final Fantasy III","incorrect_answers":["Final Fantasy VI","Final Fantasy V","Final Fantasy II"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"easy","question":"Who turns out to be the true victor in the Battle of Armageddon in Mortal Kombat?","correct_answer":"Shao Kahn","incorrect_answers":["Liu Kang","Shang Tsung","Raiden"]}],
	
	"Test 6" : [{"category":"Animals","type":"multiple","difficulty":"medium","question":"What color\/colour is a polar bear&#039;s skin?","correct_answer":"Black","incorrect_answers":["White","Pink","Green"]},{"category":"Celebrities","type":"multiple","difficulty":"easy","question":"By what name is Carlos Estevez better known? ","correct_answer":"Charlie Sheen","incorrect_answers":["Ricky Martin","Bruno Mars","Joaquin Phoenix"]},{"category":"Entertainment: Books","type":"multiple","difficulty":"medium","question":"What was the pen name of novelist, Mary Ann Evans?","correct_answer":"George Eliot","incorrect_answers":["George Orwell","George Bernard Shaw","George Saunders"]},{"category":"Entertainment: Music","type":"multiple","difficulty":"medium","question":"EDM producer Marshmello performs live wearing clothes and a marshmallow mask of what colour?","correct_answer":"White","incorrect_answers":["Black","Blue","Yellow"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"medium","question":"In Left 4 Dead, what is the name of the Special Infected that is unplayable in Versus mode?","correct_answer":"The Witch","incorrect_answers":["The Tank","The Smoker","The Spitter"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"medium","question":"What is the full name of the protagonist from the SNES game Clock Tower?","correct_answer":"Jennifer Simpson","incorrect_answers":["Jennifer Barrows","Jennifer Cartwright","Jennifer Maxwell"]},{"category":"Science: Computers","type":"multiple","difficulty":"hard","question":"Which of the following is the oldest of these computers by release date?","correct_answer":"TRS-80","incorrect_answers":["Commodore 64","ZX Spectrum","Apple 3"]},{"category":"Entertainment: Video Games","type":"multiple","difficulty":"medium","question":"When was &quot;System Shock&quot; released?","correct_answer":"1994","incorrect_answers":["1995","2000","1998"]},{"category":"Science: Computers","type":"multiple","difficulty":"hard","question":"What vulnerability ranked #1 on the OWASP Top 10 in 2013?","correct_answer":"Injection ","incorrect_answers":["Broken Authentication","Cross-Site Scripting","Insecure Direct Object References"]},{"category":"Mythology","type":"multiple","difficulty":"easy","question":"What mythological creatures have women&#039;s faces and vultures&#039; bodies?","correct_answer":"Harpies","incorrect_answers":["Mermaids","Nymph","Lilith"]}]
}

let generatedTest;	//Global variable that check test uses to get the proper test

function init(){
	let dropdown = document.getElementById("tests");	//to get the dropdown list
	let options;										//to create each of the options from the global variable
	
	for(test in tests){									//Adds each test in the object to the options list
		options = document.createElement("option");
		options.value = test;
		options.innerText = test;
		dropdown.appendChild(options);
	}
}

function loadTest(random){
	let selection;
	if(random === true){
		selection = "random";								//If load test was passed a true argument, it selects the random test
		generatedTest = true;								//Sets the global variable checkTest() refers to
	}
	else{
		selection = document.getElementById("tests").value;	//Get chosen test number
		generatedTest = false;								//Sets the global variable checkTest() refers to
	}
	
	let questions = document.getElementById("questions");	//Get the div where questions are displayed
	let question;											//The variable to create each question
	let qn;													//question number
	let position, answers;									//position is where the answer will be placed, answers is the total number of answers
	let choiceLabel;										//variable to store the label that will create each choice
	
	//clear previous questions
	while(questions.childNodes.length !== 0){
		questions.removeChild(questions.childNodes[0]);
	}
	
	//add questions from the selection
	for(test in tests){									
		if(test === selection){								//Checks which test is selected
			for(let i = 0; i < tests[test].length; i++){	//Goes through every question in the selected test
				qn = i+1;									
				question = document.createElement("p");		//Creates a new paragraph for the question
				question.id = qn;							//Gives the question an ID based on its number
				
				//Displays the question and its information
				question.innerHTML = "Question " + qn + ": Category: " + tests[test][i].category + ", Type: " + tests[test][i].type + ", difficulty: " + tests[test][i].difficulty + "<br><font color=\"black\"> Q: " + tests[test][i].question + "</font>";
				
				//Adds the choices
				answers = tests[test][i].incorrect_answers.length + 1;	//total number of answers is the no. of incorrect answers plus the 1 correct answer
				
				//Adds incorrect choices first
				for(let j = 0; j < tests[test][i].incorrect_answers.length; j++){
					//generate number between 1 and answers
					position = Math.floor(Math.random()*answers) + 1;	
					
					//create the radio button
					//Each radio group will have its name equal to the question id
					choiceLabel = document.createElement("label");	//The label for the choice
					choiceLabel.innerHTML = "<br><input type=\"radio\" name=\"" + question.id + "\" value=\"" + tests[test][i].incorrect_answers[j] + "\">" + tests[test][i].incorrect_answers[j];
					
					//inserts answer based on position value relative to j
					if(position > j){								//Append choice if position is larger than j
						question.appendChild(choiceLabel);			//Guaranteed to always run first, j starts at 0, minimum position = 1
					}
					else{											//Insert choice before the generated position if it is equal or smaller than j
						question.insertBefore(choiceLabel, question.childNodes[position + 3]);	//Add three to account because the line breaks and the text in the question are apparently behaving as child nodes
					}				
				}
				
				//Adds correct choice using similar logic to incorrect ones but based on incorrect answers length. 
				//I'll make the logic less repetitive if I have time lol
				position = Math.floor(Math.random()*answers) + 1;
				//Creat Right choice radio
				choiceLabel = document.createElement("label");
				choiceLabel.innerHTML = "<br><input type=\"radio\" name=\"" + question.id + "\" value=\"" + tests[test][i].correct_answer + "\">" + tests[test][i].correct_answer	;
				if(position > tests[test][i].incorrect_answers.length){								
					question.appendChild(choiceLabel);				
				}
				else{											
					question.insertBefore(choiceLabel, question.childNodes[position + 3]);
				}
				
				//Adds the question to the list of questions
				questions.appendChild(question);			
			}
			
			break;
		}
	}	
	
	//Add the clear test and check test buttons
	let clear = document.createElement("button");
	clear.innerHTML = "Clear Test";
	clear.id = "clear";
	clear.addEventListener("click", clearTest);
	questions.appendChild(clear);
	
	let check = document.createElement("button");
	check.innerHTML = "Check Test";
	check.id = "check";
	check.addEventListener("click", checkTest);
	questions.appendChild(check);
}

function clearTest(){
	let questions = document.getElementById("questions");				//Get the div where questions are displayed
	
	//Get and remove the previous result if it's there
	let previous = document.getElementById("result");		
	if(previous != undefined){
		previous.parentNode.removeChild(previous);
	}
	
	//Get and remove the previous images
	let pics = document.getElementById("pic");
	while(pics != undefined){
		pics.parentNode.removeChild(pics);
		pics = document.getElementById("pic");
	}	
	
	const qTotal = questions.childNodes.length - 2;						//Defines the number of questions by subtracting the extra children to questions (i.e. the buttons)
	let group;															//To store the radio group 

	if(confirm("Are you sure you want to clear all the results?")){		//true if ok is pressed, so it clears
		//Clear radio buttons
		for(let i = 1; i <= qTotal; i++){
			group = document.getElementsByName(i);						//Get radio button group
			for(let j = 0; j < group.length; j++){						//Check for the selected answer
				if(group[j].checked){
					group[j].checked = false;
					break;
				}
			}
		}
	}
}

function checkTest(){
	let quiz;
	if(generatedTest === true){
		quiz = "random";									//If a random test was generated this is retrieved when checking
	}
	else{
		quiz = document.getElementById("tests").value;		//Get the chosen test number
	}
 
	let questions = document.getElementById("questions");	//Get the div where questions are displayed
	
	//Get and remove the previous result if it's there
	let previous = document.getElementById("result");		
	if(previous != undefined){
		previous.parentNode.removeChild(previous);
	}
	
	//Get and remove the previous images
	let pics = document.getElementById("pic");
	while(pics != undefined){
		pics.parentNode.removeChild(pics);
		pics = document.getElementById("pic");
	}
	
	const qTotal = questions.childNodes.length - 2;			//Defines the number of questions by subtracting the extra children to questions (i.e. the buttons)
	let group;												//To store the radio group 
	let missedQ;											//To retrieve missed questions and change their colours
	
	//To store the list of answers, with corresponding position in radio group, and the selected value
	//Each element in array corresponds to a question in the same position
	//These are samples to be overwritten
	let answers = [{"pos" : 1, "answer" : "sample"}];	
	let unanswered = false;									//A flag to track if any questions are unanswered
		
	//Secondly retrieve all checked answers
	//If some are unchecked, set their question to red and throw an alert at the end
	for(let i = 1; i <= qTotal; i++){				//each i corresponds to a question number with a corresponding group of radios with the same number
		group = document.getElementsByName(i);		//gets the radio group
		for(let j = 0; j < group.length; j++){		//Check for the selected answer
			missedQ = document.getElementById(i);	//Question id matches i
			if(group[j].checked){
				answers[i-1] = new Object;			//Adds a new object to the array
				answers[i-1].pos = j;				//Remove one to match array positions
				answers[i-1].answer = group[j].value;
				//Makes sure question is coloured in black
				missedQ.childNodes[2].innerHTML = "<font color=\"black\">" + missedQ.childNodes[2].innerText + "</font>";	
				break;								//break the loop for this group once the checked answer is found
			}
			else if(j === (group.length - 1)){		//Executed only if it reaches last radio button and none are checked
				//child 2 corresponds to question text
				missedQ.childNodes[2].innerHTML = "<font color=\"red\">" + missedQ.childNodes[2].innerText + "</font>";
				unanswered = true;
			}
		}
	}
	
	if(unanswered){	//If there are unanswered question stops here and exits function
		alert("Must Answer All Questions!");
		return;
	}
	
	let score = 0;			//The Player's score, qTotal from earlier is total score
	
	for(let i = 0; i < answers.length; i++){
		group = document.getElementsByName(i+1);	//Get radio group of the question i+1
		if(answers[i].answer === tests[quiz][i].correct_answer){
			score++;
			//add the check to the node
			group[answers[i].pos].parentNode.innerHTML = group[answers[i].pos].parentNode.innerHTML + "<img src=\"check.png\" id=\"pic\" width=\"15\" height=\"15\">";
		}
		else{
			//add the x to the node
			group[answers[i].pos].parentNode.innerHTML = group[answers[i].pos].parentNode.innerHTML + "<img src=\"x.png\" id=\"pic\" width=\"15\" height=\"15\">";
		}
	}
	
	let result = document.createElement("p");
	result.id = "result";
	result.innerHTML = "<b> Your score is: " + score + "/" + qTotal + "!!!</b>";
	questions.appendChild(result);
}


function randomTest(){
	let xhttp = new XMLHttpRequest();				//declare the request variable
	let response;									//Object to store the response
	let selection = document.getElementById("tests");	//Get the chosen test number
	
	xhttp.open("GET", "https://opentdb.com/api.php?amount=10", true);	//make and send the request to opentdb
	xhttp.send();
	
	xhttp.onreadystatechange = function() {								//function to handle statechanges
		if(this.readyState==4 && this.status==200){						//If the data retrieval is completed
			response = JSON.parse(this.responseText);
			if(response.response_code === 0){
				selection.value = "random";							//Sets the value of the selection to random so that it deselects options
				tests.random = response.results;						//Adds retrieved test to the tests collection
				loadTest(true);											//Load test with a true argument so that it loads the random test
			}
			else{
				alert("Failed to retrieve questions. Try again!");
			}
		}
	};
}








